<!DOCTYPE HTML>
<html>
  <head>
    <title>Webcam over WebSocket using OpenCV and Tornado</title>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    var ws;
      $(document).ready(function(){
         if ("WebSocket" in window) {
            var ws_path = 'ws://localhost:{{ip}}/ws';
            //alert(ws_path);
            ws = new WebSocket (ws_path);
            //alert(ws);
            ws.onopen = function () {
               ws.send(JSON.stringify({ 'cmnd':'connected' }) ) ;
            };
            ws.onmessage = function (msg) {
               $("#cam").attr('src', 'data:image/png;base64,' + msg.data);
               // ws.send(1);
            };
            ws.onerror = function (e) {
               console.log(e);
               // ws.send(1);
            };
            ws.onclose = function(evt) {
            alert("Connection close");
            };

            // Send websocket message function
            $("#moveleft").click(function(evt) {
                ws.send(JSON.stringify({ 'cmnd':'moveleft'}) );
            });
            $("#moveright").click(function(evt) {
                ws.send(JSON.stringify({ 'cmnd':'moveright'}) );
            });
            $("#setshift").click(function(evt) {
                ws.send( JSON.stringify(  {'para':{ 'moveby':$("#moveby").val() }} ) );
            });
            $("#setwindow").click(function(evt) {
                ws.send( JSON.stringify(  {'para':{ 'window':$("#window").val() }} ) );
            });
            $("#quit").click(function(evt) {
                ws.send(JSON.stringify({ 'cmnd':'quit'}) );
            });

         } else {
             alert("WebSocket not supported");
             window.close();
         }
      });
    </script>
  </head>
  <body>
  <h1>Charts for given dataframe </h1>


  <table>
    <tr>
      <td>Window (days):  <input type="number" name="window" id="window" value="360">   <input type="submit" id="setwindow" value="set window"> </td>
    </tr>
    <tr>
      <td>Move by (days):  <input type="number" name="moveby" id="moveby" value="5">  <input type="submit" id="setshift" value="set shiftby"> </td>
    </tr>

    <tr>
    <td> <img id="cam" src=""/></td>
    </tr>

    <tr>
      <td><div style="float:left"> <input type="submit" id="moveleft" value="Move left"> </div> <div style="float:right"> <input type="submit" id="moveright" value="Move right"> </div> </td>
    </tr>
    <tr>
      <td><br><br><input type="submit" id="quit" value="Quit"> </td>
    </tr>
  </table>

  </body>
</html> 

